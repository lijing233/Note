# 页面渲染



## Performance名词解析

![](./performance.png)

**DCL** -- DOMContentLoaded Event

当 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载.



**FP** -- First Paint (首次绘制)

> FP is the time between navigation and when the browser renders the first pixels to the screen, rendering anything that is visually different from what was on the screen prior to navigation. It answers the question "Is it happening?"

FP标记浏览器渲染任何在视觉上不同于白板内容的事件点 （骨架屏）



**FCP** -- First Contentful Paint （首次内容绘制）

> FCP is when the browser renders the first bit of content from the DOM, providing the first feedback to the user that the page is actually loading. The question "Is it happening?" is "yes" when the first contentful paint completes.
>
> The First Contentful Paint time stamp is when the browser first rendered any text, image (including background images), non-white canvas or SVG. This excludes any content of iframes, but includes text with pending webfonts. This is the first time users could start consuming page content.

浏览器首次渲染任何文本，图像（包括背景图像），非白色画布或SVG时的时间戳。这不包括iframe的任何内容，但包括带有待定Web字体的文本。这是用户第一次开始使用页面内容。



**FMP** -- First Meaningful Paint (首次有效绘制)

> FMP is the paint after which the biggest above-the-fold layout change has happened and web fonts have loaded. It is when the answer to "Is it useful?" becomes "yes", upon first meaningful paint completion.

页面的首要内容（primary content）出现在屏幕上的时间，对于不同的站点，首要内容是不同的，例如：

- 对于博客文章：大标题+首屏文字是首要内容
- 对于百度或者google的搜索结果页：首屏的结果卡片就是首要内容
- 而对于淘宝等购物网站来说：图也会变得很重要



**LCP** -- Largest Contentful Paint

用于监控网页可视区内“绘制面积”最大的元素开始呈现在屏幕上的时间点



**L** -- Onload Event

当依赖的资源, 全部加载完毕之后才会触发



**TTI**



## 以用户为中心的性能指标

| 体验               | 现象                                       | 指标                             |
| ------------------ | ------------------------------------------ | -------------------------------- |
| **是否发生？**     | 导航是否成功启动？服务器是否有响应？       | 首次绘制 (FP)/首次内容绘制 (FCP) |
| **是否有用？**     | 是否已渲染可以与用户互动的足够内容？       | 首次有效绘制 (FMP)/主角元素计时  |
| **是否可用？**     | 用户可以与页面交互，还是页面仍在忙于加载？ | 可交互时间 (TTI)                 |
| **是否令人愉快？** | 交互是否顺畅而自然，没有滞后和卡顿？       | 耗时较长/占用内存的任务          |



## Chrome Performance Guide

### 启动一个performance记录

**测试demo**

https://googlechrome.github.io/devtools-samples/jank/

**1. 进入无痕模式**

`ctrl + shift + n` 进入无痕模式，以确保页面在干净的浏览器环境下运行，防止浏览器中一些插件等影响

**2.模拟移动设备cpu**

DevTools/performance/cup 设置为 4 x slowdown

**3.录制**

![](./overview.png)

### 分析结果解析

#### 1.概览部分

**FPS(frames per second - 每秒帧数/刷新率)**

![](./fps.png)

FPS可以代表页面是否流畅，我们期望页面刷新率能够在30以上，最好能到达60

图中蓝色区域代表FPS监测情况，底部绿色线条越高，FPS越高，页面越流畅；顶部出现**红色块**时，表明页面出现了卡顿

**cpu**

![](./cpu.png)

图中红色框中代表cpu使用情况

不同颜色区域代表占用cpu资源的不同事件，与summary中各事件颜色对应

纵向占用面积越高，cup占用率越高



**NET**

![](./net.png)

网络资源使用情况



#### 2.